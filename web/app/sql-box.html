<div
  ui-ace="{
    mode: 'sql',
    showGutter: false,
    rendererOptions: { fontSize: '16px' },
    advanced: { behavioursEnabled: false },
  }"
  id="sql-editor"
  ng-model="sql"></div>

<div>
  <button class="btn btn-primary" id="run-sql-button" ng-click="runSQLQuery()">Show results</button>
  <button class="btn btn-primary"
    ng-disabled="showExportOptions"
    ng-click="openExportOptions()">Save results...</button>
  <span id="sql-box-spinner" class="glyphicon glyphicon-cog" ng-if="inProgress"></span>
</div>

<form ng-show="showExportOptions" class="form-horizontal">
  <div class="form-group">
    <label for="exportFormat" class="col-sm-4 control-label">Format</label>
    <div class="col-sm-8">
      <select class="form-control" id="exportFormat" ng-model="exportFormat">
        <option value="csv">CSV</option>
        <option value="json">JSON</option>
        <option value="parquet">Parquet</option>
        <option value="orc">ORC</option>
        <option value="jdbc">Database table (via JDBC)</option>
      </select>
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat !== 'jdbc'">
    <label for="exportPath" class="col-sm-4 control-label">Path</label>
    <div class="col-sm-8">
      <input class="form-control" id="exportPath" ng-model="exportPath" value="<download>">
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'csv'">
    <label for="exportDelimiter" class="col-sm-4 control-label">Delimiter</label>
    <div class="col-sm-8">
      <input class="form-control" id="exportDelimiter" ng-model="exportDelimiter" value=",">
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'csv'">
    <label for="exportQuote" class="col-sm-4 control-label">Quote</label>
    <div class="col-sm-8">
      <input class="form-control" id="exportQuote" ng-model="exportQuote" value="&quot;">
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'csv'">
    <div class="col-sm-offset-4 col-sm-8">
      <div class="checkbox">
        <label>
          <input type="checkbox" ng-model="exportHeader"> Include header
        </label>
      </div>
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'jdbc'">
    <label for="exportJdbcUrl" class="col-sm-4 control-label">JDBC URL</label>
    <div class="col-sm-8">
      <input class="form-control" id="exportJdbcUrl" ng-model="exportJdbcUrl" placeholder="jdbc:...">
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'jdbc'">
    <label for="exportTable" class="col-sm-4 control-label">Table</label>
    <div class="col-sm-8">
      <input class="form-control" id="exportTable" ng-model="exportTable">
    </div>
  </div>

  <div class="form-group" ng-show="exportFormat === 'jdbc'">
    <div class="col-sm-offset-4 col-sm-8">
      <select class="form-control" id="exportMode" ng-model="exportMode">
        <option value="create">The table must not exist</option>
        <option value="drop">Drop the table if it already exists</option>
        <option value="insert">Insert into an existing table</option>
      </select>
    </div>
  </div>

  <div class="form-group">
    <div class="col-sm-offset-4 col-sm-8">
    <button class="btn btn-primary" ng-disabled="inProgress" ng-click="export()">Save results</button>
    <button class="btn btn-primary" ng-click="showExportOptions = false">Cancel</button>
    </div>
  </div>
</form>

<div ng-if="result && !result.$error" id="sql-result">
  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th ng-repeat="col in result.header">{{ col }}</th>
      </tr>
    </thead>
    <tbody>
      <tr ng-repeat="rows in result.data track by $index">
        <td ng-repeat="item in rows track by $index">{{ item }}</td>
      </tr>
    </tbody>
  </table>
</div>
<div id="sql-error" ng-if="result.$error">
  {{ result.$error }}
  <i class="pull-right"><a href ng-click="reportSQLError()">report problem</a></i>
</div>
