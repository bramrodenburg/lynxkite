<script type="x-shader/x-vertex" id="vertexShader">

  uniform float aspect;
  attribute float side;
  attribute vec3 direction;
  varying float brightness;
  varying float depth;
  void main() {
    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1);
    vec4 dir = projectionMatrix * modelViewMatrix * vec4(direction, 1);
    vec4 d = pos / pos.w - dir / dir.w;
    vec4 off = normalize(vec4(-d.y / aspect, d.x, 0, 0));
    gl_Position = pos + 0.4 * side * off * vec4(1.0 / aspect, 1, 1, 1);
    // TODO: Better lighting. For now it's just how horizontal the line is on the screen.
    brightness = 1.2 - 0.5 * abs(dot(vec3(0, 1, 0), vec3(normalize(dir - pos))));
    vec4 eyepos = modelViewMatrix * vec4(position, 0);
    depth = -eyepos.z;
  }

</script>
<script type="x-shader/x-vertex" id="fragmentShader">

  varying float brightness;
  varying float depth;
  void main() {
    float fog = clamp((8.0 - depth) / 20.0, 0.0, 1.0);
    gl_FragColor = fog * brightness * vec4(3, 2, 1, 1);
  }

</script>
